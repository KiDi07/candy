# Методичка по работе с Docker для Candy Bot

Эта инструкция поможет вам развернуть бота на сервере и управлять им.

## 1. Подготовка сервера (Установка Docker)

Если Docker еще не установлен, выполните эти команды на сервере (для Ubuntu/Debian):

1. **Установите Docker одной командой**:
   ```bash
   curl -fsSL https://get.docker.com | sh
   ```

2. **Добавьте своего пользователя в группу docker** (чтобы не писать `sudo` каждый раз):
   ```bash
   sudo usermod -aG docker $USER
   ```
   *После этой команды нужно переподключиться к серверу по SSH.*

3. **Проверьте установку**:
   ```bash
   docker --version
   docker compose version
   ```

## 2. Развертывание проекта

1. **Клонируйте репозиторий** (если еще не сделали):
   ```bash
   git clone https://github.com/KiDi07/candy.git
   cd candy
   ```

2. **Создайте файл `.env`** и добавьте туда ваш токен:
   ```bash
   nano .env
   ```
   Пример содержимого:
   ```env
   BOT_TOKEN=ваш_токен_бота
   ADMIN_ID=ваш_id
   ```

3. **Подготовьте файл базы данных**:
   - Если у вас **уже есть база данных**, просто скопируйте файл `db.sqlite3` в папку проекта на сервере.
   - Если базы **нет и вы начинаете с нуля**, создайте пустой файл (чтобы Docker не создал вместо него папку):
     ```bash
     touch db.sqlite3
     ```

4. **Запустите сборку и запуск контейнера**:
   ```bash
   docker compose up -d --build
   ```

## 3. Обновление проекта (Одной командой)

Я подготовил скрипт `update.sh`, который делает всё за вас (git pull, пересборка Docker, очистка мусора).

**Как запустить обновление**:
```bash
./update.sh
```

Если скрипт не запускается, дайте ему права (один раз): `chmod +x update.sh`.

## 4. Основные команды управления

| Действие | Команда |
| :--- | :--- |
| **Запуск** | `docker compose up -d` |
| **Остановка** | `docker compose stop` |
| **Остановка и удаление** | `docker compose down` |
| **Перезапуск** | `docker compose restart` |
| **Обновление вручную** | `git pull && docker compose up -d --build` |

## 5. Работа с логами (Консоль)

Чтобы посмотреть, что происходит внутри бота:

- **Просмотр последних логов**:
  ```bash
  docker compose logs
  ```
- **Следить за логами в реальном времени**:
  ```bash
  docker compose logs -f
  ```
- **Логи конкретного контейнера**:
  ```bash
  docker logs candy_bot -f
  ```

## 6. Работа с базой данных
База данных `db.sqlite3` проброшена через `volumes`. Это значит, что даже если вы удалите контейнер, данные сохранятся в файле на самом сервере в папке проекта.

## 7. Если что-то пошло не так
Если контейнер постоянно перезагружается, проверьте логи:
```bash
docker compose logs
```
Чаще всего проблема в:
1. Отсутствующем токене в `.env`.
2. В папке проекта на сервере нет файла `db.sqlite3` (или вместо него создалась папка).
3. Ошибке в коде (например, не установлена библиотека, теперь исправлено).
