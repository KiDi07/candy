# Методичка по работе с Docker для Candy Bot

Эта инструкция поможет вам развернуть бота на сервере и управлять им.

## 1. Подготовка сервера
Убедитесь, что на сервере установлены **Docker** и **Docker Compose**.

## 2. Развертывание проекта

1. **Клонируйте репозиторий** (если еще не сделали):
   ```bash
   git clone https://github.com/KiDi07/candy.git
   cd candy
   ```

2. **Создайте файл `.env`** и добавьте туда ваш токен:
   ```bash
   nano .env
   ```
   Пример содержимого:
   ```env
   BOT_TOKEN=ваш_токен_бота
   ADMIN_ID=ваш_id
   ```

3. **Подготовьте файл базы данных**:
   - Если у вас **уже есть база данных**, просто скопируйте файл `db.sqlite3` в папку проекта на сервере.
   - Если базы **нет и вы начинаете с нуля**, создайте пустой файл (чтобы Docker не создал вместо него папку):
     ```bash
     touch db.sqlite3
     ```

4. **Запустите сборку и запуск контейнера**:
   ```bash
   docker compose up -d --build
   ```
   - `-d`: запуск в фоновом режиме (detached).
   - `--build`: принудительная пересборка образа (нужно при изменении кода).

## 3. Основные команды управления

| Действие | Команда |
| :--- | :--- |
| **Запуск** | `docker compose up -d` |
| **Остановка** | `docker compose stop` |
| **Остановка и удаление** | `docker compose down` |
| **Перезапуск** | `docker compose restart` |
| **Обновление кода** | `git pull && docker compose up -d --build` |

## 4. Работа с логами (Консоль)

Чтобы посмотреть, что происходит внутри бота:

- **Просмотр последних логов**:
  ```bash
   docker compose logs
  ```
- **Следить за логами в реальном времени**:
  ```bash
  docker compose logs -f
  ```
- **Логи конкретного контейнера**:
  ```bash
  docker logs candy_bot -f
  ```

## 5. Обновление проекта на сервере

Когда вы внесли изменения в код и запушили их в Git:

```bash
git pull
docker compose up -d --build
```
Docker сам поймет, что файлы изменились, пересоберет образ и перезапустит контейнер.

## 6. Работа с базой данных
База данных `db.sqlite3` проброшена через `volumes`. Это значит, что даже если вы удалите контейнер, данные сохранятся в файле на самом сервере в папке проекта.

## 7. Если что-то пошло не так
Если контейнер постоянно перезагружается, проверьте логи:
```bash
docker compose logs
```
Чаще всего проблема в отсутствующем токене в `.env` или ошибке в коде.
